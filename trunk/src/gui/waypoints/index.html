<script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAoOnC-lqJNSFyH3kfjFZRnxT2yXp_ZAY8_ufC3CFXhHIE1NvwkxQNfin1PPwqTObduwTTg6mPuZG9RQ" type="text/javascript"></script>

<script type="text/javascript">
<!--
	window.addEvent('domready', function() {
		/*
		var accordion = new Accordion('h3', '.waypoints', {
			onActive: function(toggler, element){
			},
			onBackground: function(toggler, element){
			}
		});
		*/
		
		$$('.selectAll').addEvent('click', function(){
			//console.log(this.getParent().getParent().getParent().getParent());
			$ES('input',this.getParent().getParent().getParent().getParent()).setProperty('checked', 'checked');
		})
		
		$$('table.waypoints input').addEvent('click', function(){
			$(this.getParent().getParent()).toggleClass('selected');
		})

		GMap2.prototype.centerAndZoomOnBounds = function(bounds){
		   var center_lat = (bounds.getNorthEast().lat() + bounds.getSouthWest().lat())/2;
		   var center_lng = (bounds.getNorthEast().lng() + bounds.getSouthWest().lng())/2;
		   var center = new GLatLng(center_lat,center_lng);
		   
		   this.setCenter(center, this.getBoundsZoomLevel(bounds));
		}
		
		var map = new GMap2(document.getElementById("map"));
		map.setCenter(new GLatLng(37.4419, -122.1419), 10);
		
		var bounds = new GLatLngBounds();
		var waypoints = [];
		<? if localWaypoints: ?>
			<? for i, waypoint in enumerate(localWaypoints): ?>
				waypoints.extend([new GLatLng(<?= waypoint['latitude'] ?>, <?= waypoint['longitude'] ?>)]);
			<? end ?>
		<? end ?>
		
		<? if remoteWaypoints: ?>
			<? for i, waypoint in enumerate(remoteWaypoints): ?>
				waypoints.extend([new GLatLng(<?= waypoint['latitude'] ?>, <?= waypoint['longitude'] ?>)]);
			<? end ?>
		<? end ?>
					
		waypoints.each(function(waypoint){
		  	bounds.extend(waypoint);
			map.addOverlay(new GMarker(waypoint));
		});
		
		map.centerAndZoomOnBounds(bounds);
	});
//-->
</script>

<ul id="secondLevel">
	<li><a href="add">create a new waypoint</a></li>
</ul>

<h1>waypoints</h1>

<? if localWaypoints: ?>

<h3>local: waypoints stored on your pc</h3>
<form method="post" action="doCopyTo">
<table class="waypoints" id="local">
<thead>
    <tr>
        <th>x</th>
        <th>title</th>
        <th>latitude</th>
        <th>longitude</th>
        <th>alt</th>
        <th>type</th>
        <th>operation</th>
    </tr>
</thead>
<tbody>
<? for i, waypoint in enumerate(localWaypoints): ?>
    <tr>
        <td><input name="toBeCopied" type="checkbox" value="<?= i ?>" /></td>
        <td><?= waypoint['title'] ?></td>
        <td><?= waypoint['latitude'] ?></td>
        <td><?= waypoint['longitude'] ?></td>
        <td><?= waypoint['altitude'] ?></td>
        <td><?= waypoint['type'] ?></td>
        <td><a href="edit/<?= i ?>">edit</a><a href="doDelete/<?= i ?>">delete</a></td>
    </tr>
<? end ?>
</tbody>
<tfoot>
    <tr>
        <td colspan="6"><div class="selectAll">select all</div></td>
        <td><input type="submit" value="Copy to Device" /></td>
    </tr>
</tfoot>
</table>
</form>

<? else: ?>
You have not created any waypoints yet. <a href="add">create some!</a>
<? end ?>

<? if remoteWaypoints: ?>

<h3>remote: waypoints stored on your device</h3>
<form method="post" action="doCopyFrom">
<table class="waypoints" id="remote">
<thead>
    <tr>
        <th>x</th>
        <th>title</th>
        <th>latitude</th>
        <th>longitude</th>
        <th>alt</th>
        <th>type</th>
        <th>operation</th>
    </tr>
</thead>
<tbody>
<? for i, waypoint in enumerate(remoteWaypoints): ?>
    <tr>
        <td><input name="toBeCopied" type="checkbox" value="<?= i ?>" /></td>
        <td><?= waypoint['title'] ?></td>
        <td><?= waypoint['latitude'] ?></td>
        <td><?= waypoint['longitude'] ?></td>
        <td><?= waypoint['altitude'] ?></td>
        <td><?= waypoint['type'] ?></td>
        <td><a href="doCopyFrom/<?= i ?>">copy</a></td>
    </tr>
<? end ?>
</tbody>
<tfoot>
    <tr>
        <td colspan="6"><div class="selectAll">select all</div></td>
        <td><input type="submit" value="Copy From Device" /></td>
    </tr>
</tfoot>
</table>
</form>

<? else: ?>
You have not yet grabbed your waypoints. <a href="doGetWaypoints">Get 'em now!</a>
<? end ?>

<div id="map"></div>