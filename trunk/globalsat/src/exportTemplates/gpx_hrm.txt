<<?= str('?') ?>xml version="1.0" encoding="UTF-8"?>
<gpx version="1.1"
	creator="code.google.com/p/GH615"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:gpxdata="http://www.cluetrust.com/XML/GPXDATA/1/0"
	xmlns="http://www.topografix.com/GPX/1/1"
	xsi:schemaLocation="http://www.topografix.com/GPX/1/1
						http://www.topografix.com/GPX/1/1/gpx.xsd
						http://www.cluetrust.com/XML/GPXDATA/1/0
						http://www.cluetrust.com/Schemas/gpxdata10.xsd">

<time></time>

<? for track in tracks: ?>
<trk>
	<trkseg>
	<? for trackpoint in track['trackpoints']: ?>
		<trkpt lat="<?= trackpoint['latitude'] ?>" lon="<?= trackpoint['longitude'] ?>">
			<ele><?= trackpoint['altitude'] ?></ele>
			<speed><?= trackpoint['speed'] ?></speed>
			<time><?= trackpoint['date'].strftime("%Y-%m-%dT%H:%M:%SZ") ?></time>
			<extensions>
				<gpxdata:hr><?= trackpoint['heartrate'] ?></gpxdata:hr>
			</extensions>
		</trkpt>
	<? end ?>
	</trkseg>
</trk>
<? end ?>

<? if track['laps']: ?>
	<gpxdata:run>
		<gpxdata:sport></gpxdata:sport>
		<gpxdata:programType></gpxdata:programType>
		<gpxdata:laps>
		<? for i, lap in enumerate(track['laps']): ?>
			<gpxdata:lap>
				<gpxdata:index><?= i ?><gpxdata:index>
				<gpxdata:startPoint></gpxdata:startPoint>
				<gpxdata:endPoint></gpxdata:endPoint>
				<gpxdata:startTime><?= lap['start'].strftime("%Y-%m-%dT%H:%M:%SZ") ?></gpxdata:startTime>
				<gpxdata:elapsedTime><?= lap['elapsed'].seconds ?></gpxdata:elapsedTime>
				<gpxdata:calories><?= lap['calories'] ?></gpxdata:calories>
				<gpxdata:distance><?= lap['distance'] ?></gpxdata:distance>
				<gpxdata:trigger></gpxdata:trigger>
				<gpxdata:trackReference></gpxdata:trackReference>
			</gpxdata:lap>
		<? end ?>
		</gpxdata:laps>
	</gpxdata:run>
<? end ?>

</gpx>
