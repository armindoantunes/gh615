<?xml version="1.0" encoding="utf-8"?>
<FitnessWorkbook version="1.0" creator="code.google.com/p/GH615"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:xsd="http://www.w3.org/2001/XMLSchema"
  xmlns="http://www.zonefivesoftware.com/xmlschemas/FitnessLogbook/v1/fitnesslog.xsd">
  
  <AthleteLog>
  <% for track in tracks %>
    <Activity StartTime= "$track.date.strftime("%Y-%m-%dT%H:%M:%SZ")">
      <Metadata Source="Globalsat GH615M" Created="$track.date.strftime("%Y-%m-%dT%H:%M:%SZ")" Modified="$track.date.strftime("%Y-%m-%dT%H:%M:%SZ")" />
      <Duration TotalSeconds="${track.duration / 10.0}" /> 
      <Distance TotalMeters="$track.distance" /> 
      <Calories TotalCal="$track.calories" /> 
      <Track StartTime= "$track.date.strftime("%Y-%m-%dT%H:%M:%SZ")">
  	  <% for trackpoint in track.trackpoints %>
        <pt tm="${(trackpoint.date-track.date).days * 24.0 * 3600.0 + (trackpoint.date-track.date).seconds + (trackpoint.date-track.date).microseconds / 1000000.0}" lat="$ trackpoint.latitude" lon="$trackpoint.longitude" ele="$trackpoint.altitude" hr="$trackpoint.heartrate" dist="${(trackpoint.interval/10.0) * ((trackpoint.speed * 1000.0 )/ 3600.0)}" />
	  <% endfor %>
      </Track>
      
      <% if track.laps %>
      <Laps>
      <% for lap in track.laps %>
      <Lap StartTime="$lap.start.strftime("%Y-%m-%dT%H:%M:%SZ")" DurationSeconds="$lap.elapsed.seconds">
      	<Distance>$lap.distance</Distance>
      	<Calories>$lap.calories</Calories>
      </Lap>
      <% endfor %>
      </Laps>
      <% endif %>
    
    </Activity>
  <% end %>
  </AthleteLog>
</FitnessWorkbook>